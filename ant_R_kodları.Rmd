---
title: "KARINCA KOLONÄ°SÄ° OPTÄ°MÄ°ZASYONU"
author: "Buse BALTACIOÄLU ~ 2019900540"
date: "20 01 2021"
institute: "Deterministik Optimizasyon YÃ¶ntemleri"
output:
  bookdown::pdf_document2:
    latex_engine: lualatex
  colortheme: seahorse
  tufte::tufte_handout:
    latex_engine: xelatex
  fonttheme: structurebold
  beamer_presentation: null
  theme: Ilmenau
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
---
# SÃ¼rÃ¼ ZekasÄ± KavramÄ±

  SÃ¼rÃ¼ zekasÄ±, birlikte hareket eden sistemlerin kolektif davranÄ±ÅŸlarÄ±dÄ±r. Konsept yapay zeka ile ilgili Ã§alÄ±ÅŸmalarda kullanÄ±lmaktadÄ±r. Bu ifade 1989 senesinde Gerardo Beni ve Jing Wang tarafÄ±ndan hÃ¼cresel robot sistemleri baÄŸlamÄ±nda tanÄ±tÄ±lmÄ±ÅŸtÄ±r. SÃ¼rÃ¼ zekasÄ± sistemleri birbirleriyle ve Ã§evreleriyle etkileÅŸime giren gruplardan oluÅŸur. Gruplarda bulunan her temsilci basit kurallarÄ± takip eder ve her bir temsilcinin nasÄ±l davranmasÄ± gerektiÄŸine dair kurallar olmamasÄ±na raÄŸmen temsilciler arasÄ±ndaki etkileÅŸimler bireyin farkÄ±nda olmadÄ±ÄŸÄ± Â«akÄ±llÄ±Â» davranÄ±ÅŸÄ±n ortaya Ã§Ä±kmasÄ±na sebep olur. DoÄŸadan esinlenerek geliÅŸtirilen birÃ§ok sÃ¼rÃ¼ zekasÄ± algoritmasÄ± vardÄ±r.

---

# KarÄ±nca Kolonisi Optimizasyonu Tarihi

  KarÄ±nca koloni optimizasyonu ilk olarak 1992 senesinde Marco Dorigo tarafÄ±ndan doktora tezi olarak Ã¶nerilmiÅŸtir. Ä°lk geliÅŸtirilen algoritma iki nokta arasÄ±ndaki optimal yolu bulmayÄ± hedefleyen sezgisel bir algoritmadÄ±r. Dorigo, ilk algoritmayÄ± karÄ±nca sistemi olarak adlandÄ±rmÄ±ÅŸtÄ±r. 1999 yÄ±lÄ±nda Hoos ve StÃ¼tzle, algoritmayÄ± geliÅŸtirmiÅŸler ve maksimum-minimum karÄ±nca sistemi adÄ±nÄ± vermiÅŸlerdir. 

---

# KarÄ±nca Kolonisi AlgoritmasÄ± Felsefesi

  BirÃ§ok karÄ±nca tÃ¼rÃ¼nde, gÄ±da kaynaÄŸÄ±na gidip gelen karÄ±ncalar feromon adÄ± verilen bir maddeyi yere bÄ±rakÄ±rlar. DiÄŸer karÄ±ncalar feromonun varlÄ±ÄŸÄ±nÄ± algÄ±lar ve feromon yoÄŸunluÄŸunun daha yÃ¼ksek olduÄŸu yollarÄ± takip etme eÄŸilimi gÃ¶sterirler. 
  
  KarÄ±ncalar yÃ¼ksek feromon seviyesine sahip yolu daha yÃ¼ksek olasÄ±lÄ±kla seÃ§me eÄŸilimi gÃ¶sterdikleri iÃ§in, zaman iÃ§erisinde yol baÅŸka karÄ±ncalar tarafÄ±ndan da kullanÄ±lmaya baÅŸlar. Bunun sonucunda yol Ã¼zerinde bulunan feromon seviyesi daha belirgin hale gelir ve karÄ±nca sÃ¼rÃ¼sÃ¼nÃ¼n baÅŸarÄ±sÄ± artar. DiÄŸer bir ifadeyle, karÄ±ncalar hedeflerine ulaÅŸmak iÃ§in en verimli yolu bulmuÅŸ ve kullanmaya baÅŸlamÄ±ÅŸ olurlar.



# KarÄ±nca Kolonisi AlgoritmasÄ±

```{r echo=FALSE, out.width="400px"}
library(png)
library(grid)
img <- readPNG("C:/Users/Casper/Desktop/1.png")
 grid.raster(img)
 
```

# KarÄ±nca Kolonisi AlgoritmasÄ±nÄ±n Ä°ÅŸleyiÅŸi

**Feromon Seviyesinin Matematiksel Modeli**

```{r echo=FALSE, out.width="380px"}

img <- readPNG("C:/Users/Casper/Desktop/2.png")
 grid.raster(img)
 
```


- Denklemde delta ğ‘‡ her bir karÄ±ncanÄ±n yola bÄ±raktÄ±ÄŸÄ±nÄ± feromon miktarÄ±nÄ± temsil etmektedir. KarÄ±nca bir noktadan bir noktaya hareket ettiÄŸi iÃ§in modelde bulunan ğ‘– ve j noktalar arasÄ±ndaki mesafeyi temsil etmektedir.

- KarÄ±ncanÄ±n hareket etmemesi durumunda salgÄ±lanan feromon seviyesi 0â€™dÄ±r.

- 1/Lğ‘˜ ise iki nokta arasÄ±ndaki uzaklÄ±ÄŸÄ± ifade eder. Bu algoritmanÄ±n en kÄ±sa yolu aramasÄ±ndan kaynaklanÄ±r. Bu formÃ¼l sayesinde daha kÄ±sa yol iÃ§in daha fazla feromon seviyesi salgÄ±lanacaktÄ±r.


**Birden fazla karÄ±nca olmasÄ± durumunda noktalar arasÄ±ndaki feromon seviyesi**

```{r echo=FALSE, out.width="300px"}

img <- readPNG("C:/Users/Casper/Desktop/3.png")
 grid.raster(img)
 
```

- YukarÄ±da denklemde m toplam karÄ±nca sayÄ±sÄ±nÄ± temsil etmektedir. Her bir karÄ±nca tarafÄ±ndan yÃ¼zeye salgÄ±lanan feromon seviyesi zaman iÃ§erisinde buharlaÅŸacaktÄ±r. YukarÄ±daki denklemde buharlaÅŸma olmadan model kurulmuÅŸtur.


**Modele buharlaÅŸma ekleyerek, karÄ±ncalardan esinlendiÄŸimiz bu algoritmayÄ± daha iyi simÃ¼le edebiliriz**

```{r echo=FALSE, out.width="300px"}

img <- readPNG("C:/Users/Casper/Desktop/4.png")
 grid.raster(img)
 
```

- 1 numaralÄ± kÄ±sÄ±m mevcut feromon seviyesini, 2 numaralÄ± kÄ±sÄ±m ise diÄŸer tÃ¼m karÄ±ncalar tarafÄ±ndan salgÄ±lanan feromon seviyesini temsil etmektedir.

- Modelde gÃ¶rÃ¼ldÃ¼ÄŸÃ¼ Ã¼zere Rho sabit bir sayÄ±dÄ±r ve buharlaÅŸma oranÄ±nÄ± temsil eder.

- Rho = 0 olduÄŸu durumda herhangi bir buharlaÅŸma sÃ¶z konusu deÄŸildir.

- Rho = 1 olduÄŸu durumda ise karÄ±ncanÄ±n bÄ±raktÄ±ÄŸÄ± tÃ¼m feromon buharlaÅŸacaktÄ±r.


**OlasÄ±lÄ±klarÄ±n hesaplanmasÄ±**

```{r echo=FALSE, out.width="400px"}

img <- readPNG("C:/Users/Casper/Desktop/5.png")
 grid.raster(img)
 
```

- FormÃ¼lde eta etkisi 0â€™a indirilerek yani beta = 1 alÄ±narak olasÄ±lÄ±klar yalnÄ±zca feromon seviyesine gÃ¶re hesaplanabilir.

---

# KarÄ±nca Kolonisi Optimizasyonun AvantajlarÄ±

- EÅŸzamanlÄ± olarak bÃ¼yÃ¼k bir popÃ¼lasyon Ã¼zerinde arama yapÄ±labilir.

- Ä°yi Ã§Ã¶zÃ¼mleri hÄ±zlÄ± bir ÅŸekilde keÅŸfedebilir.

- Yeni hedeflere hÄ±zlÄ±ca uyum saÄŸlayabilir, dinamiktir.

- Hedefe yakÄ±nsama garantisi sunar.

- Gezgin satÄ±cÄ± problemi ve benzeri problemlerde etkili Ã§Ã¶zÃ¼mler sunar



# KarÄ±nca Kolonisi Optimizasyonun DezavantajlarÄ± 

- OlasÄ±lÄ±k daÄŸÄ±lÄ±mÄ± her bir yineleme iÃ§in deÄŸiÅŸebilir.

- Teorik olarak analizi zordur.

- Teorik araÅŸtÄ±rma yerine daha deneyseldir.

- Hedefe yakÄ±nsamanÄ±n ne zaman olacaÄŸÄ± belirsizdir, Ã§ok fazla iterasyon gerekebilir.

- Rastgele karar dizilerinden oluÅŸur.

---

# KarÄ±nca Kolonisi Optimizasyonun KullanÄ±ldÄ±ÄŸÄ± Uygulamalar

- Bulut tabanlÄ± sistemlerde gÃ¶rev zamanlamasÄ± ve yÃ¼k dengelemesini optimal hala getirmek iÃ§in kullanÄ±labilir. 

- Su daÄŸÄ±tÄ±m sistemleri malzeme, inÅŸaat, bakÄ±m ve enerji gereksinimleri aÃ§Ä±sÄ±ndan maliyetleri en aza indirmek iÃ§in kullanÄ±labilir. 

- Veri tabanlarÄ±nda yapÄ±lan sorgularÄ±n optimizasyonunda kullanÄ±labilir.

- SaÄŸlÄ±k alanÄ±nda yapÄ±lan Ã§alÄ±ÅŸmalarda virÃ¼sÃ¼n modellenmesinde kullanÄ±labilir. 2010 yÄ±lÄ±nda yapÄ±lan bir Ã§alÄ±ÅŸmada anti-HIV-1 aktivitelerinin tahmin edilmesinde kullanÄ±lmÄ±ÅŸtÄ±r.

- Gezgin satÄ±cÄ± problemlerinin Ã§Ã¶zÃ¼mÃ¼nde kullanÄ±labilir.

---

# KarÄ±nca Kolonisi Optimizasyonu ile Gezgin SatÄ±cÄ± Problemi

Bir ÅŸehir listesi ve her bir ÅŸehir Ã§ifti arasÄ±ndaki mesafeler gÃ¶z Ã¶nÃ¼ne alÄ±ndÄ±ÄŸÄ±nda, her ÅŸehri tam olarak bir kez ziyaret edip baÅŸlangÄ±Ã§ ÅŸehrine geri dÃ¶nen mÃ¼mkÃ¼n olan en kÄ±sa rota nedir?

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(knitr)
library(dplyr)
library(ggplot2)
```

Åehir sayÄ±sÄ±
```{r echo=TRUE, message=FALSE, warning=FALSE}
n<-10
```

Ã–klid uzayÄ±nÄ±n sÄ±nÄ±rÄ±
```{r echo=TRUE, message=FALSE, warning=FALSE}
max_x<-500
max_y<-500
```



BazÄ± rastgele ÅŸehirler
```{r echo=TRUE, message=FALSE, warning=FALSE}
set.seed(123456)
cities <- data.frame(id = 1:n, x = runif(n, max = max_x), y = runif(n, max = max_y))
```

```{r echo=TRUE, message=TRUE, warning=FALSE}
ggplot(cities, aes(x,y)) + geom_point()
```

Mesafe matrisi

```{r echo=TRUE, message=FALSE, warning=FALSE}
distance <- as.matrix(stats::dist(select(cities, x, y), diag = TRUE, upper = TRUE))
dist_fun <- function(i, j) {
  vapply(seq_along(i), function(k) distance[i[k], j[k]], numeric(1L))
}
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(ompr)
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
model <- MIPModel() %>%
  # we create a variable that is 1 iff we travel from city i to j
  add_variable(x[i, j], i = 1:n, j = 1:n, 
               type = "integer", lb = 0, ub = 1) %>%
  
  # a helper variable for the MTZ formulation of the tsp
  add_variable(u[i], i = 1:n, lb = 1, ub = n) %>% 
  
  # minimize travel distance
  set_objective(sum_expr(dist_fun(i, j) * x[i, j], i = 1:n, j = 1:n), "min") %>%
  
  # you cannot go to the same city
  set_bounds(x[i, i], ub = 0, i = 1:n) %>%
  
  # leave each city
  add_constraint(sum_expr(x[i, j], j = 1:n) == 1, i = 1:n) %>%
  #
  # visit each city
  add_constraint(sum_expr(x[i, j], i = 1:n) == 1, j = 1:n) %>%
  
  # ensure no subtours (arc constraints)
  add_constraint(u[i] >= 2, i = 2:n) %>% 
  add_constraint(u[i] - u[j] + 1 <= (n - 1) * (1 - x[i, j]), i = 2:n, j = 2:n)
```

```{r echo=TRUE, message=TRUE, warning=FALSE}
model
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(ompr.roi)
library(ROI.plugin.glpk)
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
result <- solve_model(model, with_ROI(solver = "glpk", verbose = TRUE))
```

```{r echo=TRUE, message=TRUE, warning=FALSE}
result
head(result$solution, 10)
```

Ã‡Ã¶zÃ¼mÃ¼ Ã§Ä±karmak iÃ§in get_solution, tidyverse paketlerle daha fazla kullanabileceÄŸimiz bir data.frame dÃ¶ndÃ¼ren yÃ¶ntemi kullanabiliriz .

```{r echo=TRUE, message=TRUE, warning=FALSE}
solution <- get_solution(result, x[i, j]) %>% 
  filter(value > 0) 
kable(head(solution, 3))
```

Åimdi modelimizdeki indeksleri gerÃ§ek ÅŸehirlerle tekrar iliÅŸkilendirmemiz gerekiyor.

```{r echo=TRUE, message=FALSE, warning=FALSE}
paths <- select(solution, i, j) %>% 
  rename(from = i, to = j) %>% 
  mutate(trip_id = row_number()) %>% 
  tidyr::gather(property, idx_val, from:to) %>% 
  mutate(idx_val = as.integer(idx_val)) %>% 
  inner_join(cities, by = c("idx_val" = "id"))
```

```{r echo=TRUE, message=TRUE, warning=FALSE}
kable(head(arrange(paths, trip_id), 4))
```


```{r echo=TRUE, message=FALSE, warning=FALSE}
ggplot(cities, aes(x, y)) + 
  geom_point() + 
  geom_line(data = paths, aes(group = trip_id)) + 
  ggtitle(paste0("Optimal route with cost: ", round(objective_value(result), 2)))
```

Gezgin satÄ±cÄ± problemimiz iÃ§in Ã¼rettiÄŸimiz ÅŸehirler arasÄ±nda minimum yolu bulmayÄ± hedeflemiÅŸtik ve optimal deÄŸerimizi 1469.86 bulmuÅŸ olduk.









